<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Basic Google Drive Music Player</title>
</head>
<body>

<input type="text" id="search" placeholder="Search songs..." />
<div id="songList"></div>
<audio id="audio" controls></audio>

<script>
  const apiKey = "AIzaSyDsYE91wH7UDwu8eZNbD1CFuVcilgYeZhI";
  const folderId = "1DGz9zEQh29EAqTZpmWK5mwSj5HComnkn";

  const audio = document.getElementById('audio');
  const songList = document.getElementById('songList');
  const search = document.getElementById('search');

  let allSongs = [];
  let filteredSongs = [];
  let currentIndex = -1;

  async function fetchSongs() {
    const url = `https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents+and+trashed=false&key=${apiKey}&fields=files(id,name,mimeType)&pageSize=1000`;
    const res = await fetch(url);
    const data = await res.json();

    if (data.files) {
      allSongs = data.files.filter(f => {
        return f.mimeType.startsWith('audio/') || /\.(mp3|m4a|wav)$/i.test(f.name);
      }).map(f => ({
        title: f.name.replace(/\.(mp3|m4a|wav)$/i, ''),
        url: `https://drive.google.com/uc?export=download&id=${f.id}`
      }));
      filteredSongs = [...allSongs];
      renderSongList();
    } else {
      songList.textContent = "Failed to load songs.";
    }
  }

  function renderSongList() {
    songList.innerHTML = '';
    filteredSongs.forEach((song, i) => {
      const div = document.createElement('div');
      div.textContent = song.title;
      div.style.cursor = 'pointer';
      div.onclick = () => {
        playSong(i);
      };
      songList.appendChild(div);
    });
  }

  function playSong(index) {
    currentIndex = index;
    audio.src = filteredSongs[index].url;
    audio.play();
  }

  search.addEventListener('input', () => {
    const q = search.value.toLowerCase();
    filteredSongs = allSongs.filter(song => song.title.toLowerCase().includes(q));
    renderSongList();
  });

  fetchSongs();
</script>

</body>
</html>
